stages:
  load_data:
    cmd: uv run python src/sportsinjuryner/train/00_load_injuries_data.py
    frozen: true
    deps:
    - src/sportsinjuryner/train/00_load_injuries_data.py
    outs:
    - src/data/injuries_espn.csv
    - src/data/injuries_nfl.csv

  generate_data:
    cmd: uv run python src/sportsinjuryner/train/01_convert_csv_to_ner_data.py
    deps:
    - src/data/injuries_espn.csv
    - src/sportsinjuryner/train/01_convert_csv_to_ner_data.py
    outs:
    - src/data/dev.jsonl
    - src/data/train.jsonl

  validate_data:
    cmd: uv run python src/sportsinjuryner/train/02_validate_ner_data.py
    frozen: true
    deps:
    - src/data/dev.jsonl
    - src/sportsinjuryner/train/02_validate_ner_data.py
    outs:
    - src/data/gold_standard.jsonl

  train_model:
    cmd: >-
      uv run python src/sportsinjuryner/train/03_train_injury_ner.py
      --learning_rate ${train.learning_rate}
      --per_device_train_batch_size ${train.per_device_train_batch_size}
      --weight_decay ${train.weight_decay}
      --num_train_epochs ${train.num_train_epochs}
      --warmup_ratio ${train.warmup_ratio}
      --base_model ${train.base_model}
    deps:
    - src/data/train.jsonl
    - src/data/gold_standard.jsonl
    - src/sportsinjuryner/train/03_train_injury_ner.py
    params:
    - train.learning_rate
    - train.per_device_train_batch_size
    - train.weight_decay
    - train.num_train_epochs
    - train.warmup_ratio
    - train.base_model
    outs:
    - sports-injury-ner-model

  analyze_errors:
    cmd: uv run python src/sportsinjuryner/train/05_error_analysis.py
    deps:
    - sports-injury-ner-model
    - src/data/test.jsonl
    - src/data/dev.jsonl
    - src/sportsinjuryner/train/05_error_analysis.py
    outs:
    - reports/error_analysis.csv
    - reports/test_metrics.json

  active_learning:
    cmd: uv run python src/sportsinjuryner/train/04_active_learning.py
    frozen: true
    deps:
    - sports-injury-ner-model
    - src/data/train.jsonl
    - src/data/dev.jsonl
    - src/sportsinjuryner/train/04_active_learning.py
    outs:
    - src/data/active_learning_candidates.jsonl
